{"version":3,"sources":["assets\\Script\\Class\\Message\\Choose_Train.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import AssetMng from '../../Asset/AssetMng';\r\nimport ButtonMng from '../../Data/base/ButtonMng';\r\nimport ComponentBase from '../../Data/base/ComponentBase';\r\nimport MusciMng from '../../Data/base/MusciMng';\r\nimport { Commamnd } from '../../Enum/Commad';\r\nimport { Easing } from '../../Enum/Easing';\r\nimport { GameEvent } from '../../Enum/GameEvent';\r\nimport { TrainType } from '../../Enum/TrainType';\r\nimport GameModle from '../../GameModle';\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Choose_Train extends ComponentBase {\r\n    item: cc.Node;\r\n    itmes: TrainItem[] = [];\r\n    // MineTrain: TrainItem;\r\n    content: cc.Node;\r\n    isRandom: boolean;\r\n    isStop: boolean;\r\n    tempDT: number = 0;\r\n\r\n    totaleDT: number = 0;\r\n    endDT: number = 7;\r\n    changeSpeed: number[] = [0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.75, 0.8, 0.85]\r\n    speedChange: number = 0.1;\r\n\r\n    lastShowTrain: number = 0;\r\n\r\n    btn_Start: cc.Button;\r\n\r\n\r\n    protected onLoad(): void {\r\n        this.item = cc.find(\"TrainFrame\", this.node)\r\n        this.content = cc.find(\"Layout\", this.node)\r\n        this.btn_Start = cc.find(\"btn_Check\",this.node).getComponent(cc.Button)\r\n        for (let index = 0; index < 6; index++) {\r\n            let instItme = cc.instantiate(this.item)\r\n            this.content.addChild(instItme)\r\n            instItme.setPosition(0, 0)\r\n            let _class = instItme.addComponent(TrainItem)\r\n            this.itmes.push(_class);\r\n            let getIndex = index\r\n            _class.type = getIndex\r\n        }\r\n        this.item.destroy();\r\n    }\r\n    protected start(): void {\r\n        this.node.opacity = 0\r\n        this.hide()\r\n        ButtonMng.addEvent(this.node, \"Choose_Train\", \"startRandom\", this.btn_Start)\r\n    }\r\n\r\n    protected update(dt: number): void {\r\n        if (this.isRandom) {\r\n            this.tempDT += dt;\r\n            this.totaleDT += dt;\r\n            // console.log(this.tempDT, this.speedChange);\r\n\r\n            if (this.tempDT > this.speedChange) {\r\n                this.changeShow()\r\n                this.tempDT = 0\r\n            }\r\n            if (this.totaleDT > this.endDT) {\r\n                this.isRandom = false\r\n                GameModle.playData.trainTypeNumber = this.lastShowTrain\r\n                GameModle.playData.trainType = this.changeTrainType()\r\n                this.EventEmit(GameEvent.SendCommand, Commamnd.EndChoosTrain)\r\n                //delay時間後，將圖片從畫面移動到場警(try幾個小時)\r\n            }\r\n\r\n            if (this.changeSpeed[0] != null && this.totaleDT > (this.endDT * this.changeSpeed[0])) {\r\n                // this.speedChange = this.speedChange * 2\r\n                this.speedChange = this.speedChange + Math.pow(0.6, this.changeSpeed.length)\r\n                this.changeSpeed.shift()\r\n            }\r\n        }\r\n\r\n    }\r\n    startRandom() {\r\n        MusciMng.effectPlay(\"BtnClick\")\r\n        this.btn_Start.node.active = false\r\n        this.isRandom = true;\r\n    }\r\n    initTrainSprite() {\r\n        for (let index = 0; index < this.itmes.length; index++) {\r\n            this.itmes[index].sprtie.spriteFrame = AssetMng.data_SprtieAtlas.get(\"TrainType_\" + index);\r\n        }\r\n    }\r\n\r\n    changeShow() {\r\n        this.itmes[this.lastShowTrain].noChoose()\r\n        let random = this.lastShowTrain\r\n        while (random == this.lastShowTrain) {\r\n            random = Math.floor(Math.random() * 6)\r\n        }\r\n        this.lastShowTrain = random;\r\n        this.itmes[random].choose()\r\n    }\r\n    changeTrainType() {\r\n        switch (this.lastShowTrain) {\r\n            case 0:\r\n                return TrainType.Type0;\r\n            case 1:\r\n                return TrainType.Type1;\r\n            case 2:\r\n                return TrainType.Type2;\r\n            case 3:\r\n                return TrainType.Type3;;\r\n            case 4:\r\n                return TrainType.Type4;;\r\n            case 5:\r\n                return TrainType.Type5;;\r\n        }\r\n    }\r\n    // async getTrainAciton(callback?: Function) {\r\n    //     return new Promise<void>((resolve, reject) => {\r\n    //         cc.tween(this.MineTrain.node)\r\n    //             .delay(2)\r\n    //             .repeat(2, cc.tween()\r\n    //                 .to(0.2, { scale: 1.3 })\r\n    //                 .to(1, { scale: 1 }, { easing: Easing.elasticOut })\r\n    //             )\r\n    //             .call(resolve)\r\n    //             .start()\r\n    //     })\r\n\r\n    // }\r\n}\r\n\r\n\r\nclass TrainItem extends ComponentBase {\r\n    type: number;\r\n    sprtie: cc.Sprite;\r\n    arrow: cc.Node;\r\n    protected onLoad(): void {\r\n        this.node.setScale(1)\r\n        this.arrow = cc.find(\"Arrow\", this.node)\r\n        this.sprtie = cc.find(\"Train\", this.node).getComponent(cc.Sprite)\r\n        this.sprtie.spriteFrame = null;\r\n        this.arrow.active = false\r\n    }\r\n    choose() {\r\n        this.arrow.active = true\r\n        this.node.setScale(1.3)\r\n\r\n    }\r\n    noChoose() {\r\n        this.arrow.active = false\r\n        this.node.setScale(1)\r\n    }\r\n}\r\n"]}